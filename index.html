<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="javascripts/prism/prism.css" media="screen">

    <title>ui-map-baidu by anypossiblew</title>
  </head>

  <body ng-app="uiMapBaiduApp" ng-controller="MapCtrl" ui-map-async-load>

    <header>
      <div class="container">
        <h1>ui-map-baidu</h1>
        <h2>angularjs ui for baidu map (百度地图)</h2>

        <section id="downloads">
          <a href="https://github.com/anypossiblew/ui-map-baidu/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/anypossiblew/ui-map-baidu/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/anypossiblew/ui-map-baidu" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="side-nav"
         waypoint-sticky="{'stuckClass': 'side-nav-fixed', 'offset': '50px'}" >
        <ul>
            <li><a href="#map">Map</a></li>
            <li><a href="#install">Install</a></li>
            <li><a href="#usage">Usage</a></li>
            <li><a href="#aync">异步加载</a></li>
            <li><a href="#options">Options</a></li>
            <li><a href="#ui-event">UI.Event</a></li>
        </ul>
    </div>

    <div class="container">
      <section id="main_content">
        <h3 id="map">
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true">
    <span class="octicon octicon-link"></span></a>Angularjs ui for baidu map</h3>

<p>Angularjs ui module for baidu map</p>

          <div ng-repeat="marker in myMarkers" ui-map-marker="myMarkers[$index]"
               ui-event="{'map-click': 'openMarkerInfo($event, marker)'}">
          </div>

          <div ui-map-info-window="myInfoWindow">
              <h1>Marker</h1>
              Lat: <input ng-model="currentMarkerLat">, Lng: <input ng-model="currentMarkerLng">
              <button class="btn btn-primary"
                      ng-click="setMarkerPosition(currentMarker, currentMarkerLat, currentMarkerLng)">Set Position</button>
          </div>
          <div>
              map zoom: {{zoomMessage}}
          </div>
          <div class="map-container">
              <div id="map_canvas"
                   ui-map="myMap"
                   ui-event="{'map-click': 'addMarker($event, $params)', 'map-zoomend': 'setZoomMessage(myMap.getZoom())' }"
                   ui-options="mapOptions">
              </div>
              <div class="loading" ng-hide="myMap">
                  <span>地图异步加载中...</span>
              </div>
          </div>

          <h3 id="install">Install</h3>
          <p>使用下面命令安装并保持依赖到bower.json文件</p>
<pre><code class="language-markup">bower install angular-ui-map-baidu --save</code></pre>

          <h3 id="usage">Usage</h3>
          <p>添加依赖的javascript文件到你的页面</p>

<pre><code class="language-markup">&lt;script type="text/javascript" src="bower_components/angular/angular.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="bower_components/angular-ui-utils/modules/event/event.js "&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="bower_components/angular-ui-map-baidu/ui-map.js"&gt;&lt;/script&gt;</code></pre>
          <p>不使用异步加载地图，还需加入地图链接</p>
<pre><code class="language-markup">&lt;script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=您的密钥"&gt;&lt;/script&gt;</code></pre>

          <p>在你的angular module中加入<i>ui.map</i>依赖，如下</p>

<pre><code class="language-javascript">var myAppModule = angular.module('myAppModule', ['ui.map']);</code></pre>

          <p>在你需要添加地图的地方加入ui-map directive</p>

<pre><code class="language-markup">&lt;section id="map" ng-controller="MapCtrl" &gt;
    &lt;div ui-map="myMap" ui-options="mapOptions" class="map-canvas"&gt;&lt;/div&gt;
&lt;/section&gt;</code></pre>
          <p>这里的myMap将是MapCtrl controller的$scope里的一个变量，它是<a href="http://developer.baidu.com/map/reference/index.php?title=Class:%E6%A0%B8%E5%BF%83%E7%B1%BB/Map">BMap.Map class</a>的一个实例对象。
              mapOptions则是设置map配置选项的对象变量，它是一个<a href="http://developer.baidu.com/map/reference/index.php?title=Class:%E6%A0%B8%E5%BF%83%E7%B1%BB/MapOptions">BMap.MapOptions object</a>，其中包含自定义选项。</p>
          <blockquote>
              <b>注意：</b>ui-map的dom要设置width height属性，如设置css .map-canvas {width: 100%; height: 500px;}
          </blockquote>

          <h3 id="aync">异步加载Map</h3>
          <h4>方法1</h4>
          <p>加载baidu地图时添加<a href="http://developer.baidu.com/map/jsdevelop-1.htm#.E5.BC.82.E6.AD.A5.E5.8A.A0.E8.BD.BD">异步加载地图的监听回调函数</a>如下面代码，
              函数命名为init，在init函数里加载angular app。关于angular.bootstrap参见<a href="http://docs.angularjs.org/api/angular.bootstrap">angular.bootstrap</a></p>
<pre><code class="language-javascript">function init() {
    angular.bootstrap(document.getElementById("map"), ['myAppModule']);
}</code></pre>

          <h4>方法2</h4>
          <p>如下在module config中加入加载地图链接所需要的参数</p>
<pre><code class="language-javascript">myAppModule.config(['uiMapLoadParamsProvider', function (uiMapLoadParamsProvider) {
    uiMapLoadParamsProvider.setParams({
        v: '2.0', // 版本号
        ak:'xxxx' // 你的地图密钥
    });
}]);</code></pre>
          <p>并在app的顶层dom中加上ui-map-async-load directive，使其包含ui-map</p>
<pre><code class="language-markup">&lt;body ng-controller="MapCtrl" ui-map-async-load&gt
    &lt;div ui-map="myMap" ui-options="mapOptions" class="map-canvas"&gt;&lt;/div&gt;
&lt;/body&gt;</code></pre>

          <h3 id="options">Options</h3>
          <p>在controller里的$scope上设置<a href="http://developer.baidu.com/map/reference/index.php?title=Class:%E6%A0%B8%E5%BF%83%E7%B1%BB/MapOptions">BMap.MapOptions object</a>可以通过ui-map directive的ui-options属性传给地图</p>
<pre><code class="language-javascript">myAppModule.controller('MapCtrl', ['$scope', function ($scope) {
    $scope.mapOptions = {
        mapType: BMap.MapType.BMAP_PERSPECTIVE_MAP,
        // ui map config
        uiMapCache: true // (mobile app适用)是否使用缓存来缓存此map dom，而不是每次链接跳转来都重新创建
    };
}]);</code></pre>

          <h4>ngCenter ngZoom</h4>
          <p>使用ngCenter属性设置地图初始化的中心坐标点，使用ngZoom属性设置地图初始化zoom</p>
<pre><code class="language-javascript">$scope.mapOptions = {
    mapType: BMap.MapType.BMAP_PERSPECTIVE_MAP,
    // ui map config
    ngCenter: {
        lat: 33,
        lng: 120
    },
    ngZoom: 5
};</code></pre>
          <h3 id="ui-event">UI.Event</h3>
          <p>使用<a href="http://angular-ui.github.io/ui-utils/#/event">UI.Event</a>插件可以自定义用户操作事件的响应处理逻辑，只需要在原事件名前加上前缀'map-'以绑定响应事件。
              例如地图Map的'click'或'moveend'事件可以使用UI.Event对象的key <b><i>map-click</i></b>或<b><i>map-moveend</i></b>来绑定事件，如下代码</p>
<pre><code class="language-markup">&lt;div  ui-map="myMap"ui-options="mapOptions" class="map-canvas"
    ui-event="{'map-click': 'addMarker($event, $params)', 'map-moveend': 'setZoomMessage(myMap.getZoom())' }"&gt;
&lt;/div&gt;</code></pre>

          <hr>
          <blockquote><p>如需添加复杂逻辑，可以通过$scope.myMap获取地图对象后，对其进行复杂操作</p></blockquote>
      </section>
    </div>

    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
    <script type="text/javascript" src="bower_components/angular-ui-utils/event.min.js"></script>
    <script type="text/javascript" src="bower_components/angular-ui-map-baidu/ui-map.js"></script>
    <script type="text/javascript" src="bower_components/jquery-waypoints/waypoints.min.js"></script>
    <script type="text/javascript" src="javascripts/prism/prism.js"></script>
    <script type="text/javascript" src="javascripts/app.js"></script>
    <script type="text/javascript" src="javascripts/waypoint.js"></script>

  </body>
</html>